
## 功能概述
`redeem.go` 文件主要实现了与兑换码相关的功能，包括获取兑换码数据、生成兑换码以及创建单个兑换码。这些功能用于管理和分发兑换码。

---

## 方法功能描述

### 获取兑换码数据
- **`GetRedeemData(db *sql.DB)`**  
  功能：获取兑换码的统计数据，包括每种配额的总数和已使用数量。  
  参数：
  - `db`：数据库连接。  
  返回值：`[]RedeemData`，包含兑换码统计数据的列表。  
  示例：
  ```json
  [
    {
      "quota": 10,
      "used": 5,
      "total": 20
    }
  ]
  ```

### 批量生成兑换码
- **`GenerateRedeemCodes(db *sql.DB, num int, quota float32)`**  
  功能：批量生成指定数量的兑换码。  
  参数：
  - `db`：数据库连接。
  - `num`：生成的兑换码数量。
  - `quota`：每个兑换码的配额。  
  返回值：`RedeemGenerateResponse`，包含生成状态和生成的兑换码列表。  
  示例：
  ```json
  {
    "status": true,
    "data": [
      "nio-abc123",
      "nio-def456"
    ]
  }
  ```

### 创建单个兑换码
- **`CreateRedeemCode(db *sql.DB, quota float32)`**  
  功能：生成一个新的兑换码并插入数据库。  
  参数：
  - `db`：数据库连接。
  - `quota`：兑换码的配额。  
  返回值：
  - `string`：生成的兑换码。
  - `error`：操作失败时返回错误信息。

---

## 数据结构

### `RedeemData`
兑换码统计数据结构，用于表示每种配额的总数和已使用数量。  
字段：
- `Quota`：兑换码的配额。
- `Used`：已使用的数量。
- `Total`：总数量。

### `RedeemGenerateResponse`
生成兑换码的响应结构。  
字段：
- `Status`：操作状态，布尔值。
- `Data`：生成的兑换码列表。
- `Message`：错误信息（可选）。

---

## 方法逻辑说明

### 获取兑换码数据
1. 查询数据库中每种配额的兑换码总数和已使用数量。
2. 将查询结果格式化为 `RedeemData` 列表并返回。

### 批量生成兑换码
1. 循环生成指定数量的兑换码。
2. 对每个兑换码调用 `CreateRedeemCode` 方法插入数据库。
3. 如果生成失败，返回错误信息。
4. 返回生成成功的兑换码列表。

### 创建单个兑换码
1. 生成一个随机的兑换码字符串。
2. 构造 SQL 插入语句，将兑换码存入数据库。
3. 如果遇到重复的兑换码，递归重试生成，直到成功或达到最大重试次数。

---
