# ChatNio 路由接口审查任务提示词

## 审查目标

对 ChatNio 项目的所有路由接口进行全面、细致的审查，确保文档描述与实际代码实现完全一致，不允许出现任何差错。重点审查路由接口的传参格式、响应格式、HTTP方法、路径等关键信息。

## 审查原则

1. **零容错原则**：宁可多审查一会儿，也不允许遗漏任何不一致之处
2. **逐字对比原则**：文档中的每个参数、每个字段都必须与代码实现一模一样
3. **繁琐审查原则**：审查步骤要详细、繁琐，确保覆盖所有细节
4. **多重验证原则**：每个接口至少进行3轮不同角度的审查

## 审查任务清单

### 第一阶段：基础路由映射审查

#### 任务1.1：路由路径完整性审查
- [ ] 逐一对比每个模块的 `router.go` 文件与对应文档
- [ ] 验证每个路由路径是否在文档中有对应描述
- [ ] 检查文档中是否存在代码中不存在的路由
- [ ] 验证路由分组和前缀是否正确描述

**具体审查步骤**：
1. 打开 `admin/router.go`，逐行记录所有路由定义
2. 打开 `docs/admin.md`，逐个查找对应的路由描述
3. 对比路径、HTTP方法、处理函数名称
4. 重复以上步骤审查所有模块

#### 任务1.2：HTTP方法一致性审查
- [ ] 验证每个接口的HTTP方法（GET/POST/PUT/DELETE）
- [ ] 检查文档描述的方法与代码定义是否完全一致
- [ ] 特别关注容易混淆的GET和POST方法

**审查检查点**：
- Admin模块：25个接口的HTTP方法
- Auth模块：14个接口的HTTP方法  
- Channel模块：11个接口的HTTP方法
- Manager模块：7个接口的HTTP方法
- Addition模块：7个接口的HTTP方法
- Adapter模块：1个接口的HTTP方法

#### 任务1.3：路由参数审查
- [ ] 检查路径参数（如 `:id`）的文档描述
- [ ] 验证查询参数的完整性和准确性
- [ ] 确认可选参数和必需参数的标注正确

### 第二阶段：接口参数详细审查

#### 任务2.1：请求参数结构体审查
- [ ] 对比文档中的请求参数与代码中的结构体定义
- [ ] 验证每个字段的类型、JSON标签、验证规则
- [ ] 检查必需字段和可选字段的标注

**重点审查的结构体**：
1. `admin/controller.go` 中的表单结构体
2. `auth/struct.go` 中的请求结构体
3. `manager/types.go` 中的中继请求结构体
4. `channel/types.go` 中的通道和计费结构体

#### 任务2.2：响应格式审查
- [ ] 验证每个接口的响应JSON格式
- [ ] 检查响应字段的类型和结构
- [ ] 确认错误响应格式的一致性

#### 任务2.3：数据类型精确审查
- [ ] 检查所有数字类型（int, int64, float32, float64）
- [ ] 验证字符串字段的长度限制
- [ ] 确认布尔值字段的默认值
- [ ] 检查时间格式的表示方式

### 第三阶段：业务逻辑一致性审查

#### 任务3.1：权限控制审查
- [ ] 验证需要管理员权限的接口标注
- [ ] 检查认证要求的描述准确性
- [ ] 确认访问控制的文档说明

#### 任务3.2：分页参数审查
- [ ] 检查所有分页接口的参数一致性
- [ ] 验证页码从0开始还是从1开始
- [ ] 确认分页响应格式的统一性

#### 任务3.3：错误码和状态码审查
- [ ] 验证HTTP状态码的文档描述
- [ ] 检查业务错误码的定义
- [ ] 确认错误消息格式的一致性

### 第四阶段：特殊接口深度审查

#### 任务4.1：WebSocket接口审查
- [ ] 验证WebSocket连接建立流程
- [ ] 检查消息格式的完整定义
- [ ] 确认认证流程的准确描述

**重点审查**：
- `/chat` WebSocket接口
- `/generation/create` WebSocket接口
- `/article/create` WebSocket接口

#### 任务4.2：文件上传下载接口审查
- [ ] 验证文件下载接口的参数
- [ ] 检查响应头和文件格式
- [ ] 确认文件名和MIME类型

#### 任务4.3：回调接口审查
- [ ] 验证Midjourney回调接口的完整性
- [ ] 检查IP白名单机制的描述
- [ ] 确认回调数据格式的准确性

### 第五阶段：跨模块一致性审查

#### 任务5.1：通用响应格式审查
- [ ] 检查所有模块的成功响应格式
- [ ] 验证错误响应的统一性
- [ ] 确认状态字段的一致使用

#### 任务5.2：认证机制审查
- [ ] 验证Token认证的描述一致性
- [ ] 检查API Key认证的格式要求
- [ ] 确认权限验证的流程描述

#### 任务5.3：配额计费审查
- [ ] 验证配额扣除的接口标注
- [ ] 检查计费规则的描述准确性
- [ ] 确认免费接口的标识

### 第六阶段：文档格式和引用审查

#### 任务6.1：代码引用审查
- [ ] 验证所有 `<mcfile>` 标签的路径正确性
- [ ] 检查 `<mcsymbol>` 标签的行号准确性
- [ ] 确认源代码位置注释的有效性

#### 任务6.2：示例代码审查
- [ ] 验证所有JSON示例的语法正确性
- [ ] 检查示例参数值的合理性
- [ ] 确认示例与实际接口的一致性

#### 任务6.3：表格数据审查
- [ ] 验证参数表格的完整性
- [ ] 检查字段类型的准确性
- [ ] 确认必需/可选标注的正确性

## 发现的主要不一致问题

### 1. Admin模块不一致
**问题**：文档中缺少 `POST /admin/user/root` 接口
- **代码位置**：`admin/router.go` 第26行
- **影响**：文档不完整，缺少管理员密码更新接口

### 2. Manager模块子路由缺失
**问题**：文档中未详细描述conversation和broadcast子模块的路由
- **代码位置**：`manager/conversation/router.go` 和 `manager/broadcast/router.go`
- **影响**：对话管理和广播功能的接口文档不完整

### 3. 路由分组描述不准确
**问题**：部分模块的路由分组在文档中描述不清晰
- **影响**：可能导致API调用路径错误

## 审查执行规范

### 审查人员要求
1. 必须具备Go语言和Gin框架基础知识
2. 熟悉RESTful API设计规范
3. 具备细致的文档审查能力
4. 能够理解JSON格式和HTTP协议

### 审查工具要求
1. 代码编辑器（VS Code推荐）
2. JSON格式验证工具
3. HTTP接口测试工具（Postman/Insomnia）
4. 文档对比工具

### 审查时间安排
- 第一阶段：2小时（基础路由映射）
- 第二阶段：3小时（接口参数详细审查）
- 第三阶段：2小时（业务逻辑一致性）
- 第四阶段：2小时（特殊接口深度审查）
- 第五阶段：1小时（跨模块一致性）
- 第六阶段：1小时（文档格式审查）
- **总计**：11小时

### 审查输出要求
1. 详细的不一致问题清单
2. 每个问题的具体位置和修改建议
3. 审查完成确认清单
4. 风险等级评估（高/中/低）

## 质量保证措施

### 三轮审查制度
1. **第一轮**：快速浏览，识别明显不一致
2. **第二轮**：详细对比，逐字逐句检查
3. **第三轮**：交叉验证，确认修改效果

### 审查记录要求
- 每个接口的审查状态（通过/不通过/需修改）
- 发现问题的详细描述和截图
- 修改建议和优先级排序
- 审查人员签名和时间戳

### 验收标准
- 所有路由接口100%覆盖审查
- 文档与代码0差异容忍度
- 所有示例代码可执行验证
- 接口调用测试全部通过

---

**注意**：本审查任务要求极高的细致程度和耐心，审查人员必须严格按照清单执行，不得跳过任何步骤。发现问题时必须立即记录，不得延后处理。